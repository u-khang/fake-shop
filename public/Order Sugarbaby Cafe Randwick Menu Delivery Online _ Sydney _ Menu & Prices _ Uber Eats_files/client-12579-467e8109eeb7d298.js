"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[12579],{16771:(e,t,r)=>{r.d(t,{M:()=>S,Z:()=>F});var n=r(36151),s=r(91631),i=r(62149),o=r(33535),l=r(47986),d=r(12040),u=r(85191),a=r(99990);const c="sort",p=e=>{let{filterValue:t,sortAndFilters:r,filterIndex:n,option:s}=e;if(-1===n)return[...r,s];if(0===s.options.length)return[...r.filter((e=>e.uuid!==t.uuid))];const i=[...r];return i[n]=s,i},f=e=>e.reduce(((e,t)=>{const{options:r}=t;return r&&(e[t.uuid]=r),e}),{}),h=e=>e&&e.uuid?{[e.uuid]:(e.options||[]).filter((e=>{let{selected:t}=e;return t})).map((e=>{let{uuid:t}=e;return{uuid:t||""}}))}:{},S=e=>{let{sortAndFilters:t,selectedFilter:r}=e;const s=(0,i.TH)(),o=(0,n.useMemo)((()=>(0,l.U8Z)(s.search,["sortAndFilters"])),[s.search]),u=(0,n.useMemo)((()=>(0,d.nL)(o.sortAndFilters)),[o.sortAndFilters]),a=(0,n.useMemo)((()=>((e,t)=>{const r=[];return e.forEach(((e,n)=>{t.find((t=>t.uuid===e.values?.[0]?.uuid))&&r.push(n)})),r})(t||[],u)),[t,u]),c=(0,n.useMemo)((()=>({...f(u),...h(r)})),[u,r]),p=(0,n.useMemo)((()=>((e,t)=>e.map((e=>{const r=e.values?.[0];if(!r)return e;const n=r.uuid||"",s=(r.options||[]).map((e=>{const r=t[n]?.find((t=>t.uuid===e.uuid));return{...e,selected:Boolean(r)||!t[n]&&Boolean(e.selected)}}));return"AISLE_FILTER"===e.tab&&s.sort(((e,t)=>(e.value||"").localeCompare(t.value||""))),{...e,values:[{...r,options:s}]}})))(t||[],c)),[t,c]);return{selectedSortAndFilters:u,selectedFilterIndex:a,sortAndFiltersState:p}},F=e=>{let{sortAndFilters:t,filterUpdateNavigationType:r="PUSH"}=e;const[d,f]=(0,n.useState)(null),h=(0,i.TH)(),F=(0,s.k6)(),_=(0,o.ZP)(),A=(0,o.I0)(),{storeUuid:m}=(0,a.QT)(),{selectedSortAndFilters:g,selectedFilterIndex:y,sortAndFiltersState:Z}=S({sortAndFilters:t,selectedFilter:d}),[v,b]=(0,u.Z)({root:null,rootMargin:"",threshold:0});(0,n.useEffect)((()=>{if(b&&b.isIntersecting){const e="eats:store_search_sort_and_filters_impression";A(e,{storeSearch:{storeUuid:m}},`${e}-${m}`)}}),[A,b,m]);const I=e=>{if(!e)return;const t=g.findIndex((t=>t.uuid===e.uuid));if(d?.type==c){((e,t)=>{const r=e.find((e=>e.values[0].type===c));if(r&&r.values.length>0){const t=r.values[0];if(t.options.length>0&&!0===t.options[0].selected){const t=e.findIndex((e=>e.values[0].type===c));if(-1!=t)return{sortIndex:t}}}return null})(Z)&&(e={...d,options:[]})}const{uuid:n,options:s}=e,i={uuid:n||"",options:(s||[]).map((e=>({uuid:e.uuid||""})))};-1===t&&0===i.options.length||("REPLACE"!==r?F.push((0,l.zSE)(h,p({filterValue:e,sortAndFilters:g,filterIndex:t,option:i}))):F.replace((0,l.zSE)(h,p({filterValue:e,sortAndFilters:g,filterIndex:t,option:i}))))},U=()=>{f(null)};return{selectedFilter:d,selectedSortAndFilters:g,selectedFilterIndex:y,sortAndFiltersState:Z,sortAndFiltersRef:v,handleClose:U,handleOptionSelect:e=>{d&&f({...d,options:(d.options||[]).map((t=>{const r=e.find((e=>e.uuid===t.uuid));return{...t,selected:Boolean(r)}}))})},handleReset:()=>{d&&(_("eats:store_search_sort_and_filters_reset",{storeSearch:{storeUuid:m,sortAndFilters:{uuid:d.uuid,type:d.type}}}),I({...d,options:[]}),U())},handleDone:()=>{if(d){const e=(d.options||[]).filter((e=>e.selected));_("eats:store_search_sort_and_filters_done",{storeSearch:{storeUuid:m,sortAndFilters:{uuid:d.uuid,type:d.type,isSingleOption:!1,selected:e.length>0}}}),I({...d,options:e}),U()}},handleOpen:e=>{d?.uuid===e.uuid?f(null):(_("eats:store_search_sort_and_filters_open",{storeSearch:{storeUuid:m,sortAndFilters:{uuid:e.uuid,type:e.type}}}),f(e))},handleOptionSingleSelect:e=>{const t=-1===g.findIndex((t=>t.uuid===e?.uuid));_("eats:store_search_sort_and_filters_done",{storeSearch:{storeUuid:m,sortAndFilters:{uuid:e.uuid,type:e.type,isSingleOption:!0,selected:t}}}),I({...e,options:t?e.options:[]})}}}},60402:(e,t,r)=>{r.d(t,{Z:()=>u});var n=r(1341),s=r(72238),i=r(21322),o=r(38488),l=r(33990);const d=e=>{let{options:t,onSelect:r,minPermitted:n,maxPermitted:d}=e;const u=t.filter((e=>e.selected)),a=u.length,c=e=>{const t=u.some((t=>t.uuid===e.uuid)),s=u.filter((t=>t.uuid!==e.uuid));return!t&&a<d?r([...s,e]):t&&a>n?r([...s]):void 0};return(0,l.tZ)("ul",{children:t.map((e=>(0,l.tZ)(s.Z,{onClick:()=>c(e),artwork:()=>(0,l.tZ)(o.Z,{checked:Boolean(e.selected),onChange:()=>c(e)}),children:(0,l.tZ)(i.Z,{children:e.value})},e.uuid)))})},u=e=>{let{type:t,options:r,maxPermitted:s,minPermitted:i,onSelect:o}=e;switch(t){case"sort":return(0,l.tZ)(n.Z,{options:r,onSelect:o});case"aisleFilter":case"brandFilter":return(0,l.tZ)(d,{options:r,maxPermitted:s,minPermitted:i,onSelect:o});default:return null}}},41218:(e,t,r)=>{r.d(t,{Z:()=>m});var n=r(36151),s=r(92300),i=r(32857),o=r("__fusion__958"),l=r("__fusion__1408"),d=r("__fusion__1646"),u=r("__fusion__681"),a=r(54840),c=r(89400),p=r(33990);const f=e=>{let{selectedSortAndFilters:t,options:r,uuid:n,badge:s,isSelected:i}=e;const o=t.find((e=>e.uuid===n))?.options?.[0]?.uuid,l=r.find((e=>e.uuid===o));return(0,p.tZ)(c.Z,{badge:l?l.badge:s,baseFont:"LabelSmall",baseColor:i?"contentInversePrimary":"contentPrimary"})},h={[a.GZ]:d.default,[a.Vz]:l.default},S={[a.GZ]:o.default,[a.Vz]:l.default},F={[a._l]:f},_={[a._l]:"store-search-sort-by-pill",aisleFilter:"store-search-aisle-pill",brandFilter:"store-search-brand-pill",[a.GZ]:"store-search-deals-pill"},A=(0,n.forwardRef)(((e,t)=>{let{filterValue:r,selectedSortAndFilters:o,onOpen:l,onOptionSingleSelect:d,...a}=e;const{uuid:f,type:A,options:m}=r,g=(0,n.useMemo)((()=>(o.find((e=>e.uuid===f))?.options||[]).length),[f,o]);if(!m||!m?.length)return null;const y=m.length>1,Z=y?r.badge:m[0]?.badge||r.badge,v=(A||"")in h?()=>{const e=((e,t)=>t&&e in S?S[e]:e in h?h[e]:null)(A,a.isSelected);return(0,p.tZ)(e,{})}:null,b=y?()=>(0,p.tZ)(u.default,{}):void 0,I=A?F[A]:null;return(0,p.tZ)(i.Z,{ref:t,startEnhancer:v,endEnhancer:b,...a,onClick:()=>{y?l(r):d(r)},"data-testid":_[A||""],overrides:(0,s.aO)(a.overrides,{BaseButton:{style:e=>{let{$theme:t}=e;return{whiteSpace:"nowrap"}}}}),children:I?(0,p.tZ)(I,{selectedSortAndFilters:o,options:m,uuid:f,badge:Z,isSelected:a.isSelected}):(0,p.BX)(p.HY,{children:[(0,p.tZ)(c.Z,{badge:Z,baseFont:"LabelSmall",baseColor:a.isSelected?"contentInversePrimary":"contentPrimary"}),y&&g?(0,p.BX)(p.HY,{children:["Â ",`(${g})`]}):null]})})}));A.displayName="StoreSearchSharedFilterPill";const m=A},62428:(e,t,r)=>{r.d(t,{Z:()=>l});var n=r(36151),s=r(55758),i=r(7221),o=r(16771);function l(e){let{storeUuid:t,sectionUuid:r,storeSearchQuery:l,isGrocery:d,targetLocation:u}=e;const a=(0,n.useRef)(null),[c,p]=(0,n.useState)(null),f=(0,s.d)(),{isSortAndFilterApplied:h,sortAndFiltersApplied:S}=(e=>{let{sortAndFilters:t}=e;const{selectedSortAndFilters:r,sortAndFiltersState:s}=(0,o.M)({sortAndFilters:t,selectedFilter:null}),i=(0,n.useMemo)((()=>s.map((e=>{const t=e.values?.[0];if(!t)return;const r=t.options?.filter((e=>e.selected));return r&&0!==r.length?{...t,options:r}:void 0})).filter(Boolean)),[s]);return{isSortAndFilterApplied:r.length>0,sortAndFiltersApplied:i}})({sortAndFilters:c}),F=(0,i.u)({diningMode:f,sectionUUIDs:r&&!d?[r]:null,storeUUIDs:[t],userQuery:l,isGrocery:d,targetLocation:u,entrypointContext:"IN_STORE_SEARCH",...h?{sortAndFilters:S}:null},{queryObserverOptions:{enabled:Boolean(l)}}),{error:_,isLoading:A,isSuccess:m,isError:g}=F,y=Boolean(c),Z=Boolean(m||g),v=(0,n.useMemo)((()=>({data:F.data?.catalogSectionsMap,isLoading:A||!y,error:_,isFetched:Z&&y})),[_,y,F.data,Z,A]),b=F.data?.sortAndFilters||null;return(0,n.useEffect)((()=>{!m||y&&l===a.current||(a.current=l,p(b||[]))}),[m,y,b,l]),{catalogSections:v,sortAndFilters:c}}},7221:(e,t,r)=>{r.d(t,{u:()=>o});var n=r(74622),s=r(2237),i=r(62459);function o(e,t){const r=(0,i.Z)("getInStoreSearchV1"),o=(0,s.H)("getInStoreSearchV1",e);return(0,n.useQuery)({queryKey:o,queryFn:e=>{let{queryKey:t}=e;return r.request("getInStoreSearchV1",t[1])},...t?.queryObserverOptions})}}}]);