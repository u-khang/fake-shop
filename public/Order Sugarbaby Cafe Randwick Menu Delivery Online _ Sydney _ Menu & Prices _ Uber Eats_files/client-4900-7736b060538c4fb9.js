"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[4900],{74564:(e,t,s)=>{s.d(t,{Z:()=>w});var i=s(11137),o=s(36151);function n(e){return e}class r{constructor(e){let{publishableKey:t,integrationName:s,embedMode:i,eventPrefix:o,m3:r,webEventsMetaMapper:a,universalEvents:l}=e;this.publishableKey=t,this.integrationName=s,this.embedMode=i,this.eventPrefix=o||"",this.m3=r,this.universalEvents=l,this.webEventsMetaMapper=a||n}trackTiming(e,t,s){const i=`paymentshub_${this.eventPrefix}_${e}`;t instanceof Date&&(t=Date.now()-t.getTime()),this.m3&&this.m3.timing("custom_web_event",t,{event_name:`event_${i}`,integration_name:this.integrationName,embed_mode:this.embedMode,publishable_key:this.publishableKey,...s})}trackEvent(e,t){const s=`paymentshub_${this.eventPrefix}_${e}`;this.m3&&this.m3.increment("custom_web_event",{event_name:`event_${s}`,integration_name:this.integrationName,embed_mode:this.embedMode,publishable_key:this.publishableKey,...t}),this.universalEvents&&this.universalEvents.emit("custom-hp-web-event",this.webEventsMetaMapper({name:s,type:"view",value_map:{integration_name:this.integrationName||"",embed_mode:this.embedMode,publishable_key:this.publishableKey,...t}}))}}var a=s(82744),l=s(58024),d=s(36262),p=s(93649),u=s(33990);const c={border:"none"},h={display:"flex",flexDirection:"column",boxSizing:"border-box",justifyContent:"center"};function m(e){const t=typeof e;return"number"===t||"string"===t&&!!e}function b(e){const t=(0,d.UL)(i.window.innerHeight,i.window.innerWidth);return{height:m(e.height)?e.height:t.height,width:m(e.width)?e.width:t.width}}const y=/^(https?:\/\/[^/]+)\/.*$/i;function g(e){const t=y.exec(e);if(t)return t[1];throw Error("Bad `url` format")}const v=()=>{};class w extends o.Component{trackTiming=v;trackEvent=v;hiddenForm=null;popup={window:null,closeInterval:null};constructor(e){super(e);const t=function(e){const t={key:e.publishableKey,postOrigin:i.window.location.origin};return e.options&&e.options.layout&&(t.layout=e.options.layout),e.options&&e.options.theme&&(t.theme=e.options.theme),e.organizationUuid&&(t.organizationUuid=e.organizationUuid),e.options&&e.options.context&&(t.ctx=JSON.stringify(e.options.context)),e.options&&e.options.role&&(t.role=e.options.role),e.options&&e.options.localeCode&&(t.localeCode=e.options.localeCode),e.redirectUrl&&(t.redirectUrl=e.redirectUrl),e.urlSearchParams&&Object.assign(t,{...e.urlSearchParams}),t}(e);this.state={paymentsHubUrl:(0,d.o3)(e.url,t),loading:!!e.load,failed:!1,isClient:!1},this.props.embedMode===l.j.redirect?this.targetName="_self":this.targetName=this.props.iframeName||"payments_hub"}handlePostMessage=e=>{const t=this.props?.options?.acceptableOrigins||[];if(d.Lz.concat(t).includes(e.origin)){const{resolutionHandler:t,load:s}=this.props;!this.readyTime&&this.state.loading&&s&&s.isLoaded(e.data)&&(this.trackEvent("ready"),this.readyTime=new Date,this.loadStartTime&&this.trackTiming("ready_time",this.loadStartTime),this.clearLoadTimer(),this.setState({loading:!1})),t(e.data)}};componentDidMount(){const e=this.props.analytics?.useWpeTransport?new a.A({publishableKey:this.props.publishableKey,integrationName:this.props.integrationName||"unknown",embedMode:this.props.embedMode||"unknown",eventPrefix:this.props.analytics?.eventPrefix||"",origin:g(this.props.url),tags:this.props.analytics?.tags}):new r({publishableKey:this.props.publishableKey,integrationName:this.props.integrationName||"unknown",embedMode:this.props.embedMode||"unknown",eventPrefix:this.props.analytics?.eventPrefix||"",m3:this.props.analytics?.m3,webEventsMetaMapper:this.props.analytics?.webEventsMetaMapper,universalEvents:this.props.analytics?.universalEvents});if(this.tracker=e,this.trackTiming=e.trackTiming.bind(e),this.trackEvent=e.trackEvent.bind(e),this.trackEvent("mount"),this.setLoadTimer(),this.props.embedMode===l.j.redirect){if(!this.props.postParams||!this.hiddenForm)return i.window.location.assign(this.state.paymentsHubUrl)}else i.window.addEventListener("message",this.handlePostMessage);if(this.props.embedMode===l.j.popup){const e=this.props?.options?.styleOptions||{},{top:t,left:s,width:o,height:n}=function(e){const t=b(e),s=parseInt(t.width,10),o=parseInt(t.height,10);return{top:~~((i.window.outerHeight-o)/2)+(i.window.screenTop||i.window.screenY),left:~~((i.window.outerWidth-s)/2)+(i.window.screenLeft||i.window.screenX),...t}}(e);if(this.popup.window=i.window.open(this.props.postParams?"":this.state.paymentsHubUrl,this.targetName,`top=${t},left=${s},width=${o},height=${n},toolbar,location,status,resizable,scrollbars`),!this.popup.window)return this.props.resolutionHandler({resultCode:p.lw.openFailed});this.popup.closeInterval=setInterval((()=>{this.popup.window&&!this.popup.window.closed||this.props.resolutionHandler({resultCode:p.lw.closed})}),500)}this.props.postParams&&this.hiddenForm&&this.hiddenForm.submit(),this.setState((e=>({...e,isClient:!0})))}componentWillUnmount(){this.readyTime&&(this.trackTiming("unmount_time",this.readyTime),this.trackEvent("unmount")),this.loadStartTime&&(this.trackTiming("cancel_time",this.loadStartTime),this.trackEvent("cancel")),this.clearLoadTimer(),i.window.removeEventListener("message",this.handlePostMessage),this.props.embedMode===l.j.popup&&this.popup.window&&this.popup.window.close(),clearInterval(this.popup.closeInterval)}setLoadTimer(){this.loadStartTime=new Date,this.props.load&&this.props.load.timeout>0&&(this.loadTimer=setTimeout(this.onLoadTimeout,this.props.load.timeout))}clearLoadTimer(){this.loadStartTime=null,clearTimeout(this.loadTimer)}onLoadTimeout=()=>{this.trackEvent("load_timeout"),this.setState({failed:!0,loading:!1})};onRetry=()=>{this.trackEvent("retry"),this.setLoadTimer(),this.setState({failed:!1,loading:!0})};render(){const{load:e}=this.props,{loading:t,failed:s}=this.state;if(s&&e)return e.Error(this.onRetry);const i=this.props?.options?.styleOptions||{},o=b(i),n={...c,...i,width:t?0:"100%",height:t?0:"100%"},r=Object.assign({},h,o),a=this.props.title||"Uber - Payments";return(0,u.BX)("div",{"data-test":"payments-hub-container",style:r,children:[this.props.embedMode!==l.j.popup&&this.props.embedMode!==l.j.redirect&&(this.props.postParams||this.state.isClient)&&(0,u.tZ)("iframe",{src:this.props.postParams?void 0:this.state.paymentsHubUrl,style:n,title:a,name:this.targetName}),this.props.postParams&&(0,u.tZ)("form",{ref:e=>{this.hiddenForm=e},method:"POST",action:this.state.paymentsHubUrl,target:this.targetName,children:Object.keys(this.props.postParams).map((e=>(0,u.tZ)("input",{type:"hidden",name:e,value:this.props.postParams&&this.props.postParams[e]},e)))}),t&&e&&e.Loader()]})}}},58024:(e,t,s)=>{s.d(t,{j:()=>i});const i=Object.freeze({embedded:"embedded",popup:"popup",redirect:"redirect"})},93649:(e,t,s)=>{s.d(t,{IO:()=>d,a_:()=>l,lw:()=>r,yZ:()=>a});var i=s(58024),o=s(36262);const n=["apple_pay_display","google_pay"],r=Object.freeze({openFailed:"popup_open_failed",closed:"popup_closed"}),a={width:"100%",height:"100%"};function l(e){return!0===(0,o.Jp)(e)}function d(e){return e?.tokenType&&n.includes(e.tokenType)?i.j.popup:i.j.embedded}},10817:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(33535),o=s(55793),n=s(62459);function r(){const e=(0,n.Z)("getPastOrdersV1"),t=(0,i.ZP)(),s=(0,o.m)();return async i=>{let o=0;try{const t=await e.request("getPastOrdersV1",{limit:1});t&&Array.isArray(t?.orderUuids)&&(o=t.orderUuids.length)}catch(e){}t("eats:place_order_success_client",{placeOrderSuccessClient:{...i,hasExistingOrders:o>0,...s?{entryPointData:s}:null}})}}},47813:(e,t,s)=>{s.d(t,{ZP:()=>L,CS:()=>I});var i=s(43193),o=s(75514),n=s(36151),r=s(36700),a=s(74622),l=s(91631),d=s(62149),p=s(15070),u=s(58984),c=s(47986),h=s(49201),m=s(24934),b=s(75782),y=s(64388),g=s(79526),v=s(58197),w=s(10817),f=s(27871),k=s(50818),_=s(69694),T=s(81219),P=s(70605),E=s(87696),O=s(92431),C=s(33535),U=s(62459),M=s(70940);const N={firstName:"",lastName:"",phoneNumber:"",countryCode:"",countryDialCode:"",email:""};function S(){const e=(0,U.Z)("createGuestOrdersByDraftOrdersV1"),{deliveryInstructions:t}=(0,n.useContext)(m.X3),s=t.data?.selectedInstruction,i=(0,v.Z)(),{storeUUID:S,cart:Z}=(0,_.Z)()||{},{store:{data:x}}=(0,y.ZP)(S),I=(0,M.Z)(S||""),{draftOrderUuid:L}=(0,b.Z)(),{neutralZoneTimeOut:A}=(0,g.q)(),R=Boolean(x&&L),j=(0,d.TH)(),D=(0,l.k6)(),G=(0,w.Z)(),F=(0,f.B0)("total"),H=(0,f.B0)("subtotal"),{isSingleUseItemsIncluded:$}=(0,p.v)((e=>{let{checkout:t}=e;return t}))||{},z=(0,u.I0)(),B=(0,O.Z)(),K=(0,E.FH)(B),[q,V]=(0,n.useState)(N),[W,X]=(0,n.useState)(void 0),[Y,J]=(0,n.useState)(void 0),[Q,ee]=(0,n.useState)(!1),te=(0,C.ZP)(),se=(0,n.useCallback)((()=>{J(void 0),X(void 0)}),[J,X]),ie=(0,a.useMutation)((t=>e.request("createGuestOrdersByDraftOrdersV1",t)),{onSuccess:e=>{L&&x&&(G({orderUuid:L,store:(0,k.TG)(x),cartItems:Z.data?.items||[],isGuestOrder:!0,isGuestOrderViaPaymentExpansion:!0,verticalLabel:I?"GROCERY":"RESTAURANT",fare:{total:Number((0,h.$I)(F.data?.total?.value.amountE5||0)),subTotal:Number((0,h.$I)(H.data?.subtotal?.value?.amountE5||0)),tax:0,discount:0,bookingFee:0}}),D.replace((0,c._u3)(j,{uuid:L})),(0,E.cX)(B),se(),z((0,T.yR)(L)),z((0,P.zc)()))}}),oe=(0,n.useCallback)((e=>{"checkoutActionsRequiredPayload"===e.meta?.payload?.type?(X(e.meta.payload.checkoutActionsRequiredPayload.checkoutActionParams),D.replace((0,c.vN_)((0,c.Zs0)(j),"checkoutActions"))):(te("eats:place_guest_order_click_error",{isGuestOrderViaPaymentExpansion:!0}),D.push((0,c.vN_)(j,"placeOrderError")))}),[X,D,j,te]),ne=(0,n.useCallback)((()=>{if(!R||!x||!L)return null;const e={draftOrderUUID:L,...s?{dropoffInstructionUUID:s.instructionUuid,interactionType:s.interactionType}:null,...x.singleUseItemsInfo?{isSingleUseItemsIncluded:$}:null,shareCPFWithRestaurant:!1,checkoutActionResultParams:Y,extraParams:{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,trackingCode:i.get(),storeUuid:S,cityName:x.citySlug,isTealiumEnabled:Boolean(o.Z?.utag),isNeutralZoneEnabled:Boolean(A),verticalLabel:I?"GROCERY":"RESTAURANT",cookieConsent:Boolean(K)}};ie.mutate(e,{onError:oe})}),[ie,R,K,L,I,$,x,A,i,s,S,Y,oe]),re=(0,n.useCallback)((()=>{se(),D.push((0,c.vN_)(j,"checkoutActions"))}),[se,D,j]),ae=(0,n.useCallback)((()=>{ee(!0),D.replace((0,c.vN_)(j,"checkoutLoader"))}),[ee,D,j]);return(0,n.useEffect)((()=>{Q&&((0,r.flushSync)((()=>{ee(!1)})),te("eats:place_guest_order_click",{isGuestOrderViaPaymentExpansion:!0}),ne())}),[ne,Q,ee,te]),{checkoutEnabled:R,requestCheckoutActionsPayload:re,createGuestOrder:ae,isPlacingGuestOrder:ie.isLoading,checkoutOrderActionParams:W,setCheckoutOrderActionParams:X,checkoutActionResults:Y,setCheckoutActionResults:J,isCreateGuestOrderEnqueued:Q,userInfo:q,setUserInfo:V}}var Z=s(33990);const x=i.createContext(null);function I(){const e=i.useContext(x);if(null!==e)return e;throw Error("You should use useCreateGuesyOrderContext only in a descendant of CreateGuestOrderByDraftOrderProvider")}function L(e){return(0,Z.tZ)(x.Provider,{value:{...S()},children:e.children})}},79526:(e,t,s)=>{s.d(t,{q:()=>u});var i=s(43193),o=s(91631),n=s(68799),r=s(47986),a=s(60849),l=s(96881),d=s(83960),p=s(62149);function u(){const e=(0,p.TH)(),t=(0,o.k6)(),{isBillSplitParticipant:s}=(0,d.Z)(),u=(0,a.rj)({...l.s.enable_neutral_zone,defaultValue:6e3});return{neutralZone:i.useCallback((()=>{if(!u)return!1;const i=(0,n.Z7)("uev2.nz-completed")?.completed,o=!i&&!s;return o&&t.push((0,r.yhp)(e,{fromCheckout:!0})),o}),[u,s,t,e]),neutralZoneTimeOut:u}}}}]);